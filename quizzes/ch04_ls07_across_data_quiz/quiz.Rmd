---
title: '\ '
output: blogdown::html_page
params:
  seed: 1
---

```{r, echo = F, message = F, warning = F}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(
  # necessary for all quizzes runs
  tidyverse, 
  here,
  knitr,
  googledrive,
  rio,
  # specific to this quiz             
  cowplot, 
  xfun,
  #required for it to run:
  blogdown,
  shiny,
  readxl)

knitr::opts_chunk$set(warning = F, message = F)

source(here("global/functions/misc_functions.R"))

# Setup for uploading images and datasets
if (!drive_has_token()) drive_auth(email = "trainingteam@thegraphnetwork.org")
options(gargle_oauth_email = "trainingteam@thegraphnetwork.org")
knitr::opts_knit$set(upload.fun = gdrive_upload) # pulled by knitr to upload image

# Set seed
set.seed(params$seed)
```

```{r echo = F}
diab_china_dat_raw <- 
  read_excel(here("ch04_data_wrangling/data/diabetes_china_chen.xlsx")) %>%
  select(-`BMI(kg/m2)`) %>% 
  # Sample data
  slice_sample(n = 200)
```

Here you will analyze a dataset sample of a population-based cohort in China: clinical information about adults at baseline was used to predict whether they developed diabetes after some years of followup.

The overall goal of this quizz will be to assess if you are capable of wrangling the data any number of ways, in anticipation of an "imaginary" subsequent data analysis. 

```{r echo = F, results = "asis"}
upload_and_link(diab_china_dat_raw, filename = "diab_china_dat_raw", format =  "csv")
```

Here are the top 6 rows of `diab_china_dat_raw` after import:

```{r}
head(diab_china_dat_raw)
```

------------------------------------------------------------------------

Part A : Across and mutate

**1 Across all columns containing "mmol/L": convert the columns in mol/L.**

```{r eval = F}
diab_china_dat <- 
  diab_china_dat_raw %>%
  mutate({across}({contains}("mmol/L"), 
                ~{.x}*10^-3))
```

------------------------------------------------------------------------

Part B : Across and summarize

**2 Across all columns in mmHg, calculate the mean and the standard deviation.**

```{r eval = F}
variables_mmol_per_liter <- 
  diab_china_dat_raw %>%
  summarise(across({contains}("mmHg"), 
                   {list}(mean = {mean}, sd = {sd})
                   ))
```

**3 What is the standard deviation of all the measurements of SBP (rounded to 2 decimals)? {`r round(diab_china_dat_raw %>%summarise(across(contains("mmHg"), list(mean = mean, sd = sd))) %>% select(`SBP(mmHg)_sd`) %>%pull(), 2)`}**

**4 Following a similar approach, give the minimal value of DBP (rounded to 2 decimals): {`r round(diab_china_dat_raw %>%summarise(across(contains("mmHg"), list(max = max, min = min))) %>% select(`DBP(mmHg)_min`) %>%pull(), 2)`}**


